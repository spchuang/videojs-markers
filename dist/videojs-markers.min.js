/*! videojs-markers - v0.6.0 - 2015-12-05
* Copyright (c) 2015 ; Licensed  */
"use strict";!function(e,r,i){function t(){var e=(new Date).getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==r?i:3&i|8).toString(16)});return r}function a(r){function i(){y.sort(function(e,r){return p.markerTip.time(e)-p.markerTip.time(r)})}function a(r){e.each(r,function(e,r){r.key=t(),h.find(".vjs-progress-control").append(s(r)),x[r.key]=r,y.push(r)}),i()}function o(e){return p.markerTip.time(e)/b.duration()*100}function s(r,i){var t=e("<div class='vjs-marker'></div>");return!0===p.markerStyle&&t.css(p.markerStyle),t.css({"margin-left":-parseFloat(t.css("width"))/2+"px",left:o(r)+"%"}).attr("data-marker-key",r.key).attr("data-marker-time",p.markerTip.time(r)),r["class"]&&t.addClass(r["class"]),t.on("click",function(i){var t=!1;if("function"==typeof p.onMarkerClick&&(t=0==p.onMarkerClick(r)),!t){var a=e(this).data("marker-key");b.currentTime(p.markerTip.time(x[a]))}}),p.markerTip.display&&c(t),t}function l(){for(var e=0;e<y.length;e++){var r=y[e],t=h.find(".vjs-marker[data-marker-key='"+r.key+"']"),a=p.markerTip.time(r);t.data("marker-time")!=a&&t.css({left:o(r)+"%"}).attr("data-marker-time",a)}i()}function m(e){j&&(w=-1,j.css("visibility","hidden")),T=-1;for(var r=0;r<e.length;r++){var t=e[r],a=y[t];a&&(delete x[a.key],y[t]=null,h.find(".vjs-marker[data-marker-key='"+a.key+"']").remove())}for(var r=y.length-1;r>=0;r--)null===y[r]&&y.splice(r,1);i()}function c(r){r.on("mouseover",function(){var r=x[e(this).data("marker-key")];g.find(".vjs-tip-inner").text(p.markerTip.text(r)),g.css({left:o(r)+"%","margin-left":-parseFloat(g.css("width"))/2-5+"px",visibility:"visible"})}).on("mouseout",function(){g.css("visibility","hidden")})}function k(){g=e("<div class='vjs-tip'><div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div></div>"),h.find(".vjs-progress-control").append(g)}function u(e){if(!(0>T)){var r=y[T],i=p.markerTip.time(r);e>=i&&e<=i+p.breakOverlay.displayTime?(w!=T&&(w=T,j.find(".vjs-break-overlay-text").text(p.breakOverlay.text(r))),j.css("visibility","visible")):(w=-1,j.css("visibility","hidden"))}}function v(){j=e("<div class='vjs-break-overlay'><div class='vjs-break-overlay-text'></div></div>").css(p.breakOverlay.style),h.append(j),w=-1}function d(){var e,i=function(e){return e<y.length-1?p.markerTip.time(y[e+1]):b.duration()},t=b.currentTime();if(-1!=T){var a=i(T);if(t>=p.markerTip.time(y[T])&&a>t)return}if(y.length>0&&t<p.markerTip.time(y[0]))e=-1;else for(var n=0;n<y.length;n++)if(a=i(n),t>=p.markerTip.time(y[n])&&a>t){e=n;break}e!=T&&(-1!=e&&r.onMarkerReached&&r.onMarkerReached(y[e]),T=e),p.breakOverlay.display&&u(t)}function f(){p.markerTip.display&&k(),b.markers.removeAll(),a(r.markers),p.breakOverlay.display&&v(),d(),b.on("timeupdate",d)}var p=e.extend(!0,{},n,r),x={},y=[],h=e(this.el()),T=-1,b=this,g=null,j=null,w=-1;b.on("loadedmetadata",function(){f()}),b.markers={getMarkers:function(){return y},next:function(){for(var e=b.currentTime(),r=0;r<y.length;r++){var i=p.markerTip.time(y[r]);if(i>e){b.currentTime(i);break}}},prev:function(){for(var e=b.currentTime(),r=y.length-1;r>=0;r--){var i=p.markerTip.time(y[r]);if(e>i+.5){b.currentTime(i);break}}},add:function(e){a(e)},remove:function(e){m(e)},removeAll:function(){for(var e=[],r=0;r<y.length;r++)e.push(r);m(e)},updateTime:function(){l()},reset:function(e){b.markers.removeAll(),a(e)},destroy:function(){b.markers.removeAll(),j.remove(),g.remove(),b.off("timeupdate",u),delete b.markers}}}var n={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(e){return"Break: "+e.text},time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(e){},onMarkerReached:function(e){},markers:[]};r.plugin("markers",a)}(jQuery,window.videojs);