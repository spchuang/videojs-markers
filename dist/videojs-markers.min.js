/*! videojs-markers - v0.7.0 - 2017-05-02
* Copyright (c) 2017 ; Licensed  */

"use strict";!function(a,b){function c(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)})}function d(b){function d(){u.sort(function(a,b){return s.markerTip.time(a)-s.markerTip.time(b)})}function g(a){a.forEach(function(a){a.key=c(),w.el().querySelector(".vjs-progress-holder").appendChild(i(a)),t[a.key]=a,u.push(a)}),d()}function h(a){return s.markerTip.time(a)/w.duration()*100}function i(b){var c=a.createEl("div",{className:"vjs-marker "+(b.class||"")},{"data-marker-key":b.key,"data-marker-time":s.markerTip.time(b)});return Object.keys(s.markerStyle).forEach(function(a){c.style[a]=s.markerStyle[a]}),c.style.left=h(b)+"%",c.style.marginLeft=c.getBoundingClientRect().width/2+"px",c.addEventListener("click",function(a){var c=!1;if("function"==typeof s.onMarkerClick&&(c=!1===s.onMarkerClick(b)),!c){var d=this.getAttribute("data-marker-key");w.currentTime(s.markerTip.time(t[d]))}}),s.markerTip.display&&l(c),c}function j(){u.forEach(function(a){var b=w.el().querySelector(".vjs-marker[data-marker-key='"+a.key+"']"),c=s.markerTip.time(a);b.getAttribute("data-marker-time")!==c&&(b.style.left=h(a)+"%",b.setAttribute("data-marker-time",c))}),d()}function k(a){y&&(z=f,y.style.visibility="hidden"),v=f;var b=[];a.forEach(function(a){var c=u[a];if(c){delete t[c.key],b.push(a);var d=w.el().querySelector(".vjs-marker[data-marker-key='"+c.key+"']");d.parentNode.removeChild(d)}}),b.reverse(),b.forEach(function(a){u.splice(a,1)}),d()}function l(a){a.addEventListener("mouseover",function(){var b=t[a.getAttribute("data-marker-key")];x&&(x.querySelector(".vjs-tip-inner").innerText=s.markerTip.text(b),x.style.left=h(b)+"%",x.style.marginLeft=-parseFloat(x.getBoundingClientRect().width)/2-5+"px",x.style.visibility="visible")}),a.addEventListener("mouseout",function(){x&&(x.style.visibility="hidden")})}function m(){x=a.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),w.el().querySelector(".vjs-progress-holder").appendChild(x)}function n(){if(s.breakOverlay.display&&!(v<0)){var a=w.currentTime(),b=u[v],c=s.markerTip.time(b);a>=c&&a<=c+s.breakOverlay.displayTime?(z!==v&&(z=v,y&&(y.querySelector(".vjs-break-overlay-text").innerHTML=s.breakOverlay.text(b))),y&&(y.style.visibility="visible")):(z=f,y&&(y.style.visibility="hidden"))}}function o(){y=a.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(s.breakOverlay.style).forEach(function(a){y.style[a]=s.breakOverlay.style[a]}),w.el().appendChild(y),z=f}function p(){q(),n(),b.onTimeUpdateAfterMarkerUpdate&&b.onTimeUpdateAfterMarkerUpdate()}function q(){if(u.length){var a=function(a){return a<u.length-1?s.markerTip.time(u[a+1]):w.duration()},c=w.currentTime(),d=f;if(v!==f){var e=a(v);if(c>=s.markerTip.time(u[v])&&c<e)return;if(v===u.length-1&&c===w.duration())return}if(c<s.markerTip.time(u[0]))d=f;else for(var g=0;g<u.length;g++)if(e=a(g),c>=s.markerTip.time(u[g])&&c<e){d=g;break}d!==v&&(d!==f&&b.onMarkerReached&&b.onMarkerReached(u[d],d),v=d)}}function r(){s.markerTip.display&&m(),w.markers.removeAll(),g(b.markers),s.breakOverlay.display&&o(),p(),w.on("timeupdate",p)}var s=a.mergeOptions(e,b),t={},u=[],v=f,w=this,x=null,y=null,z=f;w.on("loadedmetadata",function(){r()}),w.markers={getMarkers:function(){return u},next:function(){for(var a=w.currentTime(),b=0;b<u.length;b++){var c=s.markerTip.time(u[b]);if(c>a){w.currentTime(c);break}}},prev:function(){for(var a=w.currentTime(),b=u.length-1;b>=0;b--){var c=s.markerTip.time(u[b]);if(c+.5<a)return void w.currentTime(c)}},add:function(a){g(a)},remove:function(a){k(a)},removeAll:function(){for(var a=[],b=0;b<u.length;b++)a.push(b);k(a)},updateTime:function(){j()},reset:function(a){w.markers.removeAll(),g(a)},destroy:function(){w.markers.removeAll(),y&&y.remove(),x&&x.remove(),w.off("timeupdate",n),delete w.markers}}}var e={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(a){return"Break: "+a.text},time:function(a){return a.time}},breakOverlay:{display:!1,displayTime:3,text:function(a){return"Break overlay: "+a.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(a){},onMarkerReached:function(a,b){},markers:[]},f=-1;a.plugin("markers",d)}(window.videojs);