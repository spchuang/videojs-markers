/*! videojs-markers - v0.7.0 - 2017-05-05
* Copyright (c) 2017 ; Licensed  */

"use strict";!function(a,b){function c(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)})}function d(b){function d(){v.sort(function(a,b){return t.markerTip.time(a)-t.markerTip.time(b)})}function g(a){a.forEach(function(a){a.key=c(),x.el().querySelector(".vjs-progress-holder").appendChild(j(a)),u[a.key]=a,v.push(a)}),d()}function h(a){return t.markerTip.time(a)/x.duration()*100}function i(a){return a.duration/x.duration()*100}function j(b){var c=a.createEl("div",{className:"vjs-marker "+(b.class||"")},{"data-marker-key":b.key,"data-marker-time":t.markerTip.time(b)});return Object.keys(t.markerStyle).forEach(function(a){c.style[a]=t.markerStyle[a]}),c.style.left=h(b)+"%",b.duration?(c.style.width=i(b)+"%",c.style.marginLeft="0px"):c.style.marginLeft=c.getBoundingClientRect().width/2+"px",c.addEventListener("click",function(a){var c=!1;if("function"==typeof t.onMarkerClick&&(c=!1===t.onMarkerClick(b)),!c){var d=this.getAttribute("data-marker-key");x.currentTime(t.markerTip.time(u[d]))}}),t.markerTip.display&&m(c),c}function k(){v.forEach(function(a){var b=x.el().querySelector(".vjs-marker[data-marker-key='"+a.key+"']"),c=t.markerTip.time(a);b.getAttribute("data-marker-time")!==c&&(b.style.left=h(a)+"%",a.duration?(b.style.width=i(a)+"%",b.style.marginLeft="0px"):b.style.marginLeft=b.getBoundingClientRect().width/2+"px",b.setAttribute("data-marker-time",c))}),d()}function l(a){z&&(A=f,z.style.visibility="hidden"),w=f;var b=[];a.forEach(function(a){var c=v[a];if(c){delete u[c.key],b.push(a);var d=x.el().querySelector(".vjs-marker[data-marker-key='"+c.key+"']");d.parentNode.removeChild(d)}}),b.reverse(),b.forEach(function(a){v.splice(a,1)}),d()}function m(a){a.addEventListener("mouseover",function(){var b=u[a.getAttribute("data-marker-key")];y&&(y.querySelector(".vjs-tip-inner").innerText=t.markerTip.text(b),y.style.left=h(b)+"%",y.style.marginLeft=-parseFloat(y.getBoundingClientRect().width)/2-5+"px",y.style.visibility="visible")}),a.addEventListener("mouseout",function(){y&&(y.style.visibility="hidden")})}function n(){y=a.createEl("div",{className:"vjs-tip",innerHTML:"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>"}),x.el().querySelector(".vjs-progress-holder").appendChild(y)}function o(){if(t.breakOverlay.display&&!(w<0)){var a=x.currentTime(),b=v[w],c=t.markerTip.time(b);a>=c&&a<=c+t.breakOverlay.displayTime?(A!==w&&(A=w,z&&(z.querySelector(".vjs-break-overlay-text").innerHTML=t.breakOverlay.text(b))),z&&(z.style.visibility="visible")):(A=f,z&&(z.style.visibility="hidden"))}}function p(){z=a.createEl("div",{className:"vjs-break-overlay",innerHTML:"<div class='vjs-break-overlay-text'></div>"}),Object.keys(t.breakOverlay.style).forEach(function(a){z.style[a]=t.breakOverlay.style[a]}),x.el().appendChild(z),A=f}function q(){r(),o(),b.onTimeUpdateAfterMarkerUpdate&&b.onTimeUpdateAfterMarkerUpdate()}function r(){if(v.length){var a=function(a){return a<v.length-1?t.markerTip.time(v[a+1]):x.duration()},c=x.currentTime(),d=f;if(w!==f){var e=a(w);if(c>=t.markerTip.time(v[w])&&c<e)return;if(w===v.length-1&&c===x.duration())return}if(c<t.markerTip.time(v[0]))d=f;else for(var g=0;g<v.length;g++)if(e=a(g),c>=t.markerTip.time(v[g])&&c<e){d=g;break}d!==w&&(d!==f&&b.onMarkerReached&&b.onMarkerReached(v[d],d),w=d)}}function s(){t.markerTip.display&&n(),x.markers.removeAll(),g(b.markers),t.breakOverlay.display&&p(),q(),x.on("timeupdate",q),x.off("loadedmetadata")}var t=a.mergeOptions(e,b),u={},v=[],w=f,x=this,y=null,z=null,A=f;x.on("loadedmetadata",function(){s()}),x.markers={getMarkers:function(){return v},next:function(){for(var a=x.currentTime(),b=0;b<v.length;b++){var c=t.markerTip.time(v[b]);if(c>a){x.currentTime(c);break}}},prev:function(){for(var a=x.currentTime(),b=v.length-1;b>=0;b--){var c=t.markerTip.time(v[b]);if(c+.5<a)return void x.currentTime(c)}},add:function(a){g(a)},remove:function(a){l(a)},removeAll:function(){for(var a=[],b=0;b<v.length;b++)a.push(b);l(a)},updateTime:function(){k()},reset:function(a){x.markers.removeAll(),g(a)},destroy:function(){x.markers.removeAll(),z&&z.remove(),y&&y.remove(),x.off("timeupdate",o),delete x.markers}}}var e={markerStyle:{width:"7px","border-radius":"30%","background-color":"red"},markerTip:{display:!0,text:function(a){return"Break: "+a.text},time:function(a){return a.time}},breakOverlay:{display:!1,displayTime:3,text:function(a){return"Break overlay: "+a.overlayText},style:{width:"100%",height:"20%","background-color":"rgba(0,0,0,0.7)",color:"white","font-size":"17px"}},onMarkerClick:function(a){},onMarkerReached:function(a,b){},markers:[]},f=-1;a.plugin("markers",d)}(window.videojs);