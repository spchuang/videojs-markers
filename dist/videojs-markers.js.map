{"version":3,"sources":["videojs-markers.js"],"names":["videojs","undefined","defaultSetting","markerStyle","markerTip","display","text","marker","time","breakOverlay","displayTime","overlayText","style","onMarkerClick","onMarkerReached","index","markers","generateUUID","d","Date","getTime","uuid","replace","c","r","Math","random","floor","toString","NULL_INDEX","registerVideoJsMarkersPlugin","options","setting","mergeOptions","markersMap","markersList","currentMarkerIndex","player","overlayIndex","sortMarkersList","sort","a","b","addMarkers","newMarkers","forEach","key","el","querySelector","appendChild","createMarkerDiv","push","getPosition","duration","getWidth","markerDiv","createEl","className","class","Object","keys","left","width","marginLeft","getBoundingClientRect","addEventListener","e","preventDefault","getAttribute","currentTime","registerMarkerTipHandler","updateMarkers","markerTime","setAttribute","removeMarkers","indexArray","visibility","deleteIndexList","parentNode","removeChild","reverse","deleteIndex","splice","innerText","parseFloat","initializeMarkerTip","innerHTML","updateBreakOverlay","initializeOverlay","onTimeUpdate","onUpdateMarker","onTimeUpdateAfterMarkerUpdate","length","getNextMarkerTime","newMarkerIndex","nextMarkerTime","i","initialize","removeAll","on","off","getMarkers","next","prev","add","remove","updateTime","reset","destroy","plugin","window"],"mappings":"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","file":"videojs-markers.js","sourcesContent":["/*! videojs-markers - v0.7.0 - 2017-05-05\n* Copyright (c) 2017 ; Licensed  */\n'use strict';\n\ntype Marker = {\n  time: number,\n  duration: number,\n  text?: string,\n  class?: string,\n  overlayText?: string,\n  // private property\n  key: string,\n};\n\n(function(videojs, undefined) {\n  // default setting\n  const defaultSetting = {\n    markerStyle: {\n      'width':'7px',\n      'border-radius': '30%',\n      'background-color': 'red',\n    },\n    markerTip: {\n      display: true,\n      text: function(marker) {\n        return \"Break: \" + marker.text;\n      },\n      time: function(marker) {\n        return marker.time;\n      },\n    },\n    breakOverlay:{\n      display: false,\n      displayTime: 3,\n      text: function(marker) {\n        return \"Break overlay: \" + marker.overlayText;\n      },\n      style: {\n        'width':'100%',\n        'height': '20%',\n        'background-color': 'rgba(0,0,0,0.7)',\n        'color': 'white',\n        'font-size': '17px',\n      },\n    },\n    onMarkerClick: function(marker) {},\n    onMarkerReached: function(marker, index) {},\n    markers: [],\n  };\n\n  // create a non-colliding random number\n  function generateUUID(): string {\n    var d = new Date().getTime();\n    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      var r = (d + Math.random()*16)%16 | 0;\n      d = Math.floor(d/16);\n      return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n    });\n    return uuid;\n  };\n\n  const NULL_INDEX = -1;\n\n  function registerVideoJsMarkersPlugin(options) {\n    /**\n     * register the markers plugin (dependent on jquery)\n     */\n\n    let setting = videojs.mergeOptions(defaultSetting, options),\n        markersMap: {[key:string]: Marker} = {},\n        markersList: Array<Marker>  = [], // list of markers sorted by time\n        currentMarkerIndex  = NULL_INDEX,\n        player       = this,\n        markerTip    = null,\n        breakOverlay = null,\n        overlayIndex = NULL_INDEX;\n\n    function sortMarkersList(): void {\n      // sort the list by time in asc order\n      markersList.sort((a, b) => {\n        return setting.markerTip.time(a) - setting.markerTip.time(b);\n      });\n    }\n\n    function addMarkers(newMarkers: Array<Marker>): void {\n      newMarkers.forEach((marker: Marker) => {\n        marker.key = generateUUID();\n\n        player.el().querySelector('.vjs-progress-holder')\n          .appendChild(createMarkerDiv(marker));\n\n        // store marker in an internal hash map\n        markersMap[marker.key] = marker;\n        markersList.push(marker);\n      })\n\n      sortMarkersList();\n    }\n\n    function getPosition(marker: Marker): number {\n      return (setting.markerTip.time(marker) / player.duration()) * 100;\n    }\n\n    function getWidth(marker: Marker): number {\n      return (marker.duration / player.duration()) * 100;\n    }\n\n    function createMarkerDiv(marker: Marker): Object {\n      var markerDiv = videojs.createEl('div', {\n        className: `vjs-marker ${marker.class || \"\"}`,\n      }, {\n        'data-marker-key': marker.key,\n        'data-marker-time': setting.markerTip.time(marker)\n      });\n      Object.keys(setting.markerStyle).forEach(key => {\n        markerDiv.style[key] = setting.markerStyle[key];\n      });\n      markerDiv.style.left = getPosition(marker) + '%';\n      if (marker.duration) {\n        markerDiv.style.width = getWidth(marker) + '%';\n        markerDiv.style.marginLeft = '0px';\n      } else {\n        markerDiv.style.marginLeft = markerDiv.getBoundingClientRect().width/2 + 'px';\n      }\n\n      // bind click event to seek to marker time\n      markerDiv.addEventListener('click', function(e) {\n        var preventDefault = false;\n        if (typeof setting.onMarkerClick === \"function\") {\n          // if return false, prevent default behavior\n          preventDefault = setting.onMarkerClick(marker) === false;\n        }\n\n        if (!preventDefault) {\n          var key = this.getAttribute('data-marker-key');\n          player.currentTime(setting.markerTip.time(markersMap[key]));\n        }\n      });\n\n      if (setting.markerTip.display) {\n        registerMarkerTipHandler(markerDiv);\n      }\n\n      return markerDiv;\n    }\n\n    function updateMarkers(): void {\n      // update UI for markers whose time changed\n      markersList.forEach((marker: Marker) => {\n        var markerDiv = player.el().querySelector(\".vjs-marker[data-marker-key='\" + marker.key +\"']\");\n        var markerTime = setting.markerTip.time(marker);\n\n        if (markerDiv.getAttribute('data-marker-time') !== markerTime) {\n          markerDiv.style.left = getPosition(marker) + '%';\n          if (marker.duration) {\n            markerDiv.style.width = getWidth(marker) + '%';\n            markerDiv.style.marginLeft = '0px';\n          } else {\n            markerDiv.style.marginLeft = markerDiv.getBoundingClientRect().width/2 + 'px';\n          }\n          markerDiv.setAttribute('data-marker-time', markerTime);\n        }\n      });\n      sortMarkersList();\n    }\n\n    function removeMarkers(indexArray: Array<number>): void {\n      // reset overlay\n      if (!!breakOverlay){\n        overlayIndex = NULL_INDEX;\n        breakOverlay.style.visibility = \"hidden\";\n      }\n      currentMarkerIndex = NULL_INDEX;\n\n      let deleteIndexList: Array<number> = [];\n      indexArray.forEach((index: number) => {\n        let marker = markersList[index];\n        if (marker) {\n          // delete from memory\n          delete markersMap[marker.key];\n          deleteIndexList.push(index);\n\n          // delete from dom\n          let el = player.el().querySelector(\".vjs-marker[data-marker-key='\" + marker.key +\"']\");\n          el.parentNode.removeChild(el);\n        }\n      });\n\n      // clean up markers array\n      deleteIndexList.reverse();\n      deleteIndexList.forEach((deleteIndex: number) => {\n        markersList.splice(deleteIndex, 1);\n      });\n\n      // sort again\n      sortMarkersList();\n    }\n\n    // attach hover event handler\n    function registerMarkerTipHandler(markerDiv: Object): void {\n      markerDiv.addEventListener('mouseover', () => {\n        var marker = markersMap[markerDiv.getAttribute('data-marker-key')];\n\n        if (!!markerTip) {\n          markerTip.querySelector('.vjs-tip-inner').innerText = setting.markerTip.text(marker);\n\n          // margin-left needs to minus the padding length to align correctly with the marker\n          markerTip.style.left = getPosition(marker) + '%';\n          markerTip.style.marginLeft = -parseFloat(markerTip.getBoundingClientRect().width) / 2 - 5 + 'px';\n          markerTip.style.visibility = 'visible';\n        }\n      });\n\n      markerDiv.addEventListener('mouseout',() => {\n        if (!!markerTip) {\n          markerTip.style.visibility = \"hidden\";\n        }\n      });\n    }\n\n    function initializeMarkerTip(): void {\n      markerTip = videojs.createEl('div', {\n        className: 'vjs-tip',\n        innerHTML: \"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>\",\n      });\n      player.el().querySelector('.vjs-progress-holder').appendChild(markerTip);\n    }\n\n    // show or hide break overlays\n    function updateBreakOverlay(): void {\n      if (!setting.breakOverlay.display || currentMarkerIndex < 0) {\n        return;\n      }\n\n      var currentTime = player.currentTime();\n      var marker = markersList[currentMarkerIndex];\n      var markerTime = setting.markerTip.time(marker);\n\n      if (\n        currentTime >= markerTime &&\n        currentTime <= (markerTime + setting.breakOverlay.displayTime)\n      ) {\n        if (overlayIndex !== currentMarkerIndex) {\n          overlayIndex = currentMarkerIndex;\n          if (breakOverlay) {\n            breakOverlay.querySelector('.vjs-break-overlay-text').innerHTML = setting.breakOverlay.text(marker);\n          }\n        }\n\n        if (breakOverlay) {\n          breakOverlay.style.visibility = \"visible\";\n        }\n      } else {\n        overlayIndex = NULL_INDEX;\n        if (breakOverlay) {\n          breakOverlay.style.visibility = \"hidden\";\n        }\n      }\n    }\n\n    // problem when the next marker is within the overlay display time from the previous marker\n    function initializeOverlay(): void {\n      breakOverlay = videojs.createEl('div', {\n        className: 'vjs-break-overlay',\n        innerHTML: \"<div class='vjs-break-overlay-text'></div>\"\n      });\n      Object.keys(setting.breakOverlay.style).forEach(key => {\n        breakOverlay.style[key] = setting.breakOverlay.style[key]\n      });\n      player.el().appendChild(breakOverlay);\n      overlayIndex = NULL_INDEX;\n    }\n\n    function onTimeUpdate(): void {\n      onUpdateMarker();\n      updateBreakOverlay();\n      options.onTimeUpdateAfterMarkerUpdate && options.onTimeUpdateAfterMarkerUpdate();\n    }\n\n    function onUpdateMarker() {\n      /*\n        check marker reached in between markers\n        the logic here is that it triggers a new marker reached event only if the player\n        enters a new marker range (e.g. from marker 1 to marker 2). Thus, if player is on marker 1 and user clicked on marker 1 again, no new reached event is triggered)\n      */\n      if (!markersList.length) {\n        return;\n      }\n\n      var getNextMarkerTime = (index: number) => {\n        if (index < markersList.length - 1) {\n          return setting.markerTip.time(markersList[index + 1]);\n        }\n        // next marker time of last marker would be end of video time\n        return player.duration();\n      }\n      var currentTime = player.currentTime();\n      var newMarkerIndex = NULL_INDEX;\n\n      if (currentMarkerIndex !== NULL_INDEX) {\n        // check if staying at same marker\n        var nextMarkerTime = getNextMarkerTime(currentMarkerIndex);\n        if(\n          currentTime >= setting.markerTip.time(markersList[currentMarkerIndex]) &&\n          currentTime < nextMarkerTime\n        ) {\n          return;\n        }\n\n        // check for ending (at the end current time equals player duration)\n        if (\n          currentMarkerIndex === markersList.length - 1 &&\n          currentTime === player.duration()\n        ) {\n          return;\n        }\n      }\n\n      // check first marker, no marker is selected\n      if (currentTime < setting.markerTip.time(markersList[0])) {\n        newMarkerIndex = NULL_INDEX;\n      } else {\n        // look for new index\n        for (var i = 0; i < markersList.length; i++) {\n          nextMarkerTime = getNextMarkerTime(i);\n          if (\n            currentTime >= setting.markerTip.time(markersList[i]) &&\n            currentTime < nextMarkerTime\n          ) {\n            newMarkerIndex = i;\n            break;\n          }\n        }\n      }\n\n      // set new marker index\n      if (newMarkerIndex !== currentMarkerIndex) {\n        // trigger event if index is not null\n        if (newMarkerIndex !== NULL_INDEX && options.onMarkerReached) {\n          options.onMarkerReached(markersList[newMarkerIndex], newMarkerIndex);\n        }\n        currentMarkerIndex = newMarkerIndex;\n      }\n    }\n\n    // setup the whole thing\n    function initialize(): void {\n      if (setting.markerTip.display) {\n        initializeMarkerTip();\n      }\n\n      // remove existing markers if already initialized\n      player.markers.removeAll();\n      addMarkers(options.markers);\n\n      if (setting.breakOverlay.display) {\n        initializeOverlay();\n      }\n      onTimeUpdate();\n      player.on(\"timeupdate\", onTimeUpdate);\n      player.off(\"loadedmetadata\");\n    }\n\n    // setup the plugin after we loaded video's meta data\n    player.on(\"loadedmetadata\", function() {\n      initialize();\n    });\n\n    // exposed plugin API\n    player.markers = {\n      getMarkers: function(): Array<Marker> {\n        return markersList;\n      },\n      next : function(): void {\n        // go to the next marker from current timestamp\n        const currentTime = player.currentTime();\n        for (var i = 0; i < markersList.length; i++) {\n          var markerTime = setting.markerTip.time(markersList[i]);\n          if (markerTime > currentTime) {\n            player.currentTime(markerTime);\n            break;\n          }\n        }\n      },\n      prev : function(): void {\n        // go to previous marker\n        const currentTime = player.currentTime();\n        for (var i = markersList.length - 1; i >= 0 ; i--) {\n          var markerTime = setting.markerTip.time(markersList[i]);\n          // add a threshold\n          if (markerTime + 0.5 < currentTime) {\n            player.currentTime(markerTime);\n            return;\n          }\n        }\n      },\n      add : function(newMarkers: Array<Marker>): void {\n        // add new markers given an array of index\n        addMarkers(newMarkers);\n      },\n      remove: function(indexArray: Array<number>): void {\n        // remove markers given an array of index\n        removeMarkers(indexArray);\n      },\n      removeAll: function(): void {\n        var indexArray = [];\n        for (var i = 0; i < markersList.length; i++) {\n          indexArray.push(i);\n        }\n        removeMarkers(indexArray);\n      },\n      updateTime: function(): void {\n        // notify the plugin to update the UI for changes in marker times\n        updateMarkers();\n      },\n      reset: function(newMarkers: Array<Marker>): void {\n        // remove all the existing markers and add new ones\n        player.markers.removeAll();\n        addMarkers(newMarkers);\n      },\n      destroy: function(): void {\n        // unregister the plugins and clean up even handlers\n        player.markers.removeAll();\n        breakOverlay && breakOverlay.remove();\n        markerTip && markerTip.remove();\n        player.off(\"timeupdate\", updateBreakOverlay);\n        delete player.markers;\n      },\n    };\n  }\n\n  videojs.plugin('markers', registerVideoJsMarkersPlugin);\n\n})(window.videojs);\n"]}