{"version":3,"sources":["videojs-markers.js"],"names":["defaultSetting","markerStyle","markerTip","display","text","marker","time","breakOverlay","displayTime","overlayText","style","onMarkerClick","onMarkerReached","index","markers","generateUUID","d","Date","getTime","uuid","replace","c","r","Math","random","floor","toString","NULL_INDEX","registerVideoJsMarkersPlugin","options","mergeOptions","isPlain","value","call","constructor","Object","source1","source2","result","sources","forEach","source","keys","key","dom","createEl","tagName","props","attrs","el","Player","prototype","setAttribute","setting","markersMap","markersList","currentMarkerIndex","player","overlayIndex","sortMarkersList","sort","a","b","addMarkers","newMarkers","querySelector","appendChild","createMarkerDiv","push","getPosition","duration","markerDiv","className","class","left","marginLeft","getBoundingClientRect","width","addEventListener","e","preventDefault","getAttribute","currentTime","registerMarkerTipHandler","updateMarkers","markerTime","removeMarkers","indexArray","visibility","deleteIndexList","parentNode","removeChild","reverse","deleteIndex","splice","innerText","parseFloat","initializeMarkerTip","innerHTML","updateBreakOverlay","initializeOverlay","onTimeUpdate","onUpdateMarker","onTimeUpdateAfterMarkerUpdate","length","getNextMarkerTime","newMarkerIndex","nextMarkerTime","i","initialize","removeAll","on","ready","getMarkers","next","prev","add","remove","updateTime","reset","destroy","off","registerPlugin"],"mappings":"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","file":"videojs-markers.js","sourcesContent":["/*! videojs-markers - v0.9.0 - 2017-10-20\n* Copyright (c) 2017 ; Licensed  */\n'use strict';\n\nimport videojs from 'video.js';\n\ntype Marker = {\n  time: number,\n  text?: string,\n  class?: string,\n  overlayText?: string,\n  // private property\n  key: string,\n};\n\n// default setting\nconst defaultSetting = {\n  markerStyle: {\n    'width':'7px',\n    'border-radius': '30%',\n    'background-color': 'red',\n  },\n  markerTip: {\n    display: true,\n    text: function(marker) {\n      return \"Break: \" + marker.text;\n    },\n    time: function(marker) {\n      return marker.time;\n    },\n  },\n  breakOverlay:{\n    display: false,\n    displayTime: 3,\n    text: function(marker) {\n      return \"Break overlay: \" + marker.overlayText;\n    },\n    style: {\n      'width':'100%',\n      'height': '20%',\n      'background-color': 'rgba(0,0,0,0.7)',\n      'color': 'white',\n      'font-size': '17px',\n    },\n  },\n  onMarkerClick: function(marker) {},\n  onMarkerReached: function(marker, index) {},\n  markers: [],\n};\n\n// create a non-colliding random number\nfunction generateUUID(): string {\n  var d = new Date().getTime();\n  var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    var r = (d + Math.random()*16)%16 | 0;\n    d = Math.floor(d/16);\n    return (c=='x' ? r : (r&0x3|0x8)).toString(16);\n  });\n  return uuid;\n};\n\nconst NULL_INDEX = -1;\n\nfunction registerVideoJsMarkersPlugin(options) {\n  // copied from video.js/src/js/utils/merge-options.js since\n  // videojs 4 doens't support it by defualt.\n  if (!videojs.mergeOptions) {\n    function isPlain(value) {\n      return !!value && typeof value === 'object' &&\n        toString.call(value) === '[object Object]' &&\n        value.constructor === Object;\n    }\n    function mergeOptions(source1: Object, source2: Object) {\n\n      const result = {};\n      const sources = [source1, source2];\n      sources.forEach(source => {\n        if (!source) {\n          return;\n        }\n        Object.keys(source).forEach(key => {\n          let value = source[key];\n          if (!isPlain(value)) {\n            result[key] = value;\n            return;\n          }\n          if (!isPlain(result[key])) {\n            result[key] = {};\n          }\n          result[key] = mergeOptions(result[key], value);\n        })\n      });\n      return result;\n    }\n    videojs.mergeOptions = mergeOptions;\n  }\n\n  if (!videojs.dom.createEl) {\n    videojs.dom.createEl = function(tagName: string, props: Object, attrs?: Object): void {\n      const el = videojs.Player.prototype.dom.createEl(tagName, props);\n      if (!!attrs) {\n        Object.keys(attrs).forEach(key => {\n          el.setAttribute(key, attrs[key]);\n        });\n      }\n      return el;\n    }\n  }\n  \n\n  /**\n   * register the markers plugin (dependent on jquery)\n   */\n  let setting = videojs.mergeOptions(defaultSetting, options),\n      markersMap: {[key:string]: Marker} = {},\n      markersList: Array<Marker>  = [], // list of markers sorted by time\n      currentMarkerIndex  = NULL_INDEX,\n      player       = this,\n      markerTip    = null,\n      breakOverlay = null,\n      overlayIndex = NULL_INDEX;\n\n  function sortMarkersList(): void {\n    // sort the list by time in asc order\n    markersList.sort((a, b) => {\n      return setting.markerTip.time(a) - setting.markerTip.time(b);\n    });\n  }\n\n  function addMarkers(newMarkers: Array<Marker>): void {\n    newMarkers.forEach((marker: Marker) => {\n      marker.key = generateUUID();\n\n      player.el().querySelector('.vjs-progress-holder')\n        .appendChild(createMarkerDiv(marker));\n\n      // store marker in an internal hash map\n      markersMap[marker.key] = marker;\n      markersList.push(marker);\n    })\n\n    sortMarkersList();\n  }\n\n  function getPosition(marker: Marker): number {\n    return (setting.markerTip.time(marker) / player.duration()) * 100;\n  }\n\n  function createMarkerDiv(marker: Marker): Object {\n    var markerDiv = videojs.dom.createEl('div', {\n      className: `vjs-marker ${marker.class || \"\"}`,\n    }, {\n      'data-marker-key': marker.key,\n      'data-marker-time': setting.markerTip.time(marker)\n    });\n\n    Object.keys(setting.markerStyle).forEach(key => {\n      markerDiv.style[key] = setting.markerStyle[key];\n    });\n    markerDiv.style.left = getPosition(marker) + '%';\n    markerDiv.style.marginLeft = markerDiv.getBoundingClientRect().width/2 + 'px';\n\n    // bind click event to seek to marker time\n    markerDiv.addEventListener('click', function(e) {\n      var preventDefault = false;\n      if (typeof setting.onMarkerClick === \"function\") {\n        // if return false, prevent default behavior\n        preventDefault = setting.onMarkerClick(marker) === false;\n      }\n\n      if (!preventDefault) {\n        var key = this.getAttribute('data-marker-key');\n        player.currentTime(setting.markerTip.time(markersMap[key]));\n      }\n    });\n\n    if (setting.markerTip.display) {\n      registerMarkerTipHandler(markerDiv);\n    }\n\n    return markerDiv;\n  }\n\n  function updateMarkers(): void {\n    // update UI for markers whose time changed\n    markersList.forEach((marker: Marker) => {\n      var markerDiv = player.el().querySelector(\".vjs-marker[data-marker-key='\" + marker.key +\"']\");\n      var markerTime = setting.markerTip.time(marker);\n\n      if (markerDiv.getAttribute('data-marker-time') !== markerTime) {\n        markerDiv.style.left = getPosition(marker) + '%';\n        markerDiv.setAttribute('data-marker-time', markerTime);\n      }\n    });\n    sortMarkersList();\n  }\n\n  function removeMarkers(indexArray: Array<number>): void {\n    // reset overlay\n    if (!!breakOverlay){\n      overlayIndex = NULL_INDEX;\n      breakOverlay.style.visibility = \"hidden\";\n    }\n    currentMarkerIndex = NULL_INDEX;\n\n    let deleteIndexList: Array<number> = [];\n    indexArray.forEach((index: number) => {\n      let marker = markersList[index];\n      if (marker) {\n        // delete from memory\n        delete markersMap[marker.key];\n        deleteIndexList.push(index);\n\n        // delete from dom\n        let el = player.el().querySelector(\".vjs-marker[data-marker-key='\" + marker.key +\"']\");\n        el.parentNode.removeChild(el);\n      }\n    });\n\n    // clean up markers array\n    deleteIndexList.reverse();\n    deleteIndexList.forEach((deleteIndex: number) => {\n      markersList.splice(deleteIndex, 1);\n    });\n\n    // sort again\n    sortMarkersList();\n  }\n\n  // attach hover event handler\n  function registerMarkerTipHandler(markerDiv: Object): void {\n    markerDiv.addEventListener('mouseover', () => {\n      var marker = markersMap[markerDiv.getAttribute('data-marker-key')];\n      if (!!markerTip) {\n        markerTip.querySelector('.vjs-tip-inner').innerText = setting.markerTip.text(marker);\n        // margin-left needs to minus the padding length to align correctly with the marker\n        markerTip.style.left = getPosition(marker) + '%';\n        markerTip.style.marginLeft = \n          -parseFloat(markerTip.getBoundingClientRect().width / 2) + parseFloat(markerDiv.getBoundingClientRect().width / 4) + 'px';\n        markerTip.style.visibility = 'visible';\n      }\n    });\n\n    markerDiv.addEventListener('mouseout',() => {\n      if (!!markerTip) {\n        markerTip.style.visibility = \"hidden\";\n      }\n    });\n  }\n\n  function initializeMarkerTip(): void {\n    markerTip = videojs.dom.createEl('div', {\n      className: 'vjs-tip',\n      innerHTML: \"<div class='vjs-tip-arrow'></div><div class='vjs-tip-inner'></div>\",\n    });\n    player.el().querySelector('.vjs-progress-holder').appendChild(markerTip);\n  }\n\n  // show or hide break overlays\n  function updateBreakOverlay(): void {\n    if (!setting.breakOverlay.display || currentMarkerIndex < 0) {\n      return;\n    }\n\n    var currentTime = player.currentTime();\n    var marker = markersList[currentMarkerIndex];\n    var markerTime = setting.markerTip.time(marker);\n\n    if (\n      currentTime >= markerTime &&\n      currentTime <= (markerTime + setting.breakOverlay.displayTime)\n    ) {\n      if (overlayIndex !== currentMarkerIndex) {\n        overlayIndex = currentMarkerIndex;\n        if (breakOverlay) {\n          breakOverlay.querySelector('.vjs-break-overlay-text').innerHTML = setting.breakOverlay.text(marker);\n        }\n      }\n\n      if (breakOverlay) {\n        breakOverlay.style.visibility = \"visible\";\n      }\n    } else {\n      overlayIndex = NULL_INDEX;\n      if (breakOverlay) {\n        breakOverlay.style.visibility = \"hidden\";\n      }\n    }\n  }\n\n  // problem when the next marker is within the overlay display time from the previous marker\n  function initializeOverlay(): void {\n    breakOverlay = videojs.dom.createEl('div', {\n      className: 'vjs-break-overlay',\n      innerHTML: \"<div class='vjs-break-overlay-text'></div>\"\n    });\n    Object.keys(setting.breakOverlay.style).forEach(key => {\n      if (breakOverlay) {\n        breakOverlay.style[key] = setting.breakOverlay.style[key];\n      }\n    });\n    player.el().appendChild(breakOverlay);\n    overlayIndex = NULL_INDEX;\n  }\n\n  function onTimeUpdate(): void {\n    onUpdateMarker();\n    updateBreakOverlay();\n    options.onTimeUpdateAfterMarkerUpdate && options.onTimeUpdateAfterMarkerUpdate();\n  }\n\n  function onUpdateMarker() {\n    /*\n      check marker reached in between markers\n      the logic here is that it triggers a new marker reached event only if the player\n      enters a new marker range (e.g. from marker 1 to marker 2). Thus, if player is on marker 1 and user clicked on marker 1 again, no new reached event is triggered)\n    */\n    if (!markersList.length) {\n      return;\n    }\n\n    var getNextMarkerTime = (index: number) => {\n      if (index < markersList.length - 1) {\n        return setting.markerTip.time(markersList[index + 1]);\n      }\n      // next marker time of last marker would be end of video time\n      return player.duration();\n    }\n    var currentTime = player.currentTime();\n    var newMarkerIndex = NULL_INDEX;\n\n    if (currentMarkerIndex !== NULL_INDEX) {\n      // check if staying at same marker\n      var nextMarkerTime = getNextMarkerTime(currentMarkerIndex);\n      if(\n        currentTime >= setting.markerTip.time(markersList[currentMarkerIndex]) &&\n        currentTime < nextMarkerTime\n      ) {\n        return;\n      }\n\n      // check for ending (at the end current time equals player duration)\n      if (\n        currentMarkerIndex === markersList.length - 1 &&\n        currentTime === player.duration()\n      ) {\n        return;\n      }\n    }\n\n    // check first marker, no marker is selected\n    if (currentTime < setting.markerTip.time(markersList[0])) {\n      newMarkerIndex = NULL_INDEX;\n    } else {\n      // look for new index\n      for (var i = 0; i < markersList.length; i++) {\n        nextMarkerTime = getNextMarkerTime(i);\n        if (\n          currentTime >= setting.markerTip.time(markersList[i]) &&\n          currentTime < nextMarkerTime\n        ) {\n          newMarkerIndex = i;\n          break;\n        }\n      }\n    }\n\n    // set new marker index\n    if (newMarkerIndex !== currentMarkerIndex) {\n      // trigger event if index is not null\n      if (newMarkerIndex !== NULL_INDEX && options.onMarkerReached) {\n        options.onMarkerReached(markersList[newMarkerIndex], newMarkerIndex);\n      }\n      currentMarkerIndex = newMarkerIndex;\n    }\n  }\n\n  // setup the whole thing\n  function initialize(): void {\n    if (setting.markerTip.display) {\n      initializeMarkerTip();\n    }\n\n    // remove existing markers if already initialized\n    player.markers.removeAll();\n    addMarkers(options.markers);\n\n    if (setting.breakOverlay.display) {\n      initializeOverlay();\n    }\n    onTimeUpdate();\n    player.on(\"timeupdate\", onTimeUpdate);\n    // player.off(\"loadedmetadata\");\n  }\n\n  // setup the plugin after we loaded video's meta data\n  // player.on(\"loadedmetadata\", function() {\n  //   initialize();\n  // });\n  player.ready(function(){\n    initialize();\n  })\n\n  // exposed plugin API\n  player.markers = {\n    getMarkers: function(): Array<Marker> {\n      return markersList;\n    },\n    next : function(): void {\n      // go to the next marker from current timestamp\n      const currentTime = player.currentTime();\n      for (var i = 0; i < markersList.length; i++) {\n        var markerTime = setting.markerTip.time(markersList[i]);\n        if (markerTime > currentTime) {\n          player.currentTime(markerTime);\n          break;\n        }\n      }\n    },\n    prev : function(): void {\n      // go to previous marker\n      const currentTime = player.currentTime();\n      for (var i = markersList.length - 1; i >= 0 ; i--) {\n        var markerTime = setting.markerTip.time(markersList[i]);\n        // add a threshold\n        if (markerTime + 0.5 < currentTime) {\n          player.currentTime(markerTime);\n          return;\n        }\n      }\n    },\n    add : function(newMarkers: Array<Marker>): void {\n      // add new markers given an array of index\n      addMarkers(newMarkers);\n    },\n    remove: function(indexArray: Array<number>): void {\n      // remove markers given an array of index\n      removeMarkers(indexArray);\n    },\n    removeAll: function(): void {\n      var indexArray = [];\n      for (var i = 0; i < markersList.length; i++) {\n        indexArray.push(i);\n      }\n      removeMarkers(indexArray);\n    },\n    updateTime: function(): void {\n      // notify the plugin to update the UI for changes in marker times\n      updateMarkers();\n    },\n    reset: function(newMarkers: Array<Marker>): void {\n      // remove all the existing markers and add new ones\n      player.markers.removeAll();\n      addMarkers(newMarkers);\n    },\n    destroy: function(): void {\n      // unregister the plugins and clean up even handlers\n      player.markers.removeAll();\n      breakOverlay && breakOverlay.remove();\n      markerTip && markerTip.remove();\n      player.off(\"timeupdate\", updateBreakOverlay);\n      delete player.markers;\n    },\n  };\n}\n\nvideojs.registerPlugin('markers', registerVideoJsMarkersPlugin);\n"]}